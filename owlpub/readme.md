# owl-pub

## Конфигурационный файл

Конфигурационный файл - config.json

Ассоциативный массив directories. Обязательный параметр.

Содержит в себе адреса рабочих директорий.

Ключи directories:

repos - директория, в которой будут размещаться репозитории. Обязательный параметр.

web - директория, которая будет доступна извне с помощью веб-сервера. В ней будут располагаться сгенерированные файлы документации. Обязательный параметр.

Массив repos. Обязательный параметр.

Содержит в себе адреса обслуживаемых репозиториев и настройки публикации онтологий

Ключи repos:

clone_url - адрес репозитория для осуществления клонирования, например, https://github.com/ailabitmo/food-ontology.git

webhook_id - уникальный id хука, целое число > 0. Необязательный параметр. Используется для обслуживания репозиториев, отличных от github: для инициации синхронизации изменений и регенерации репозитория достаточно послать get-запрос на адрес вида http://yourdomain.example/webhook/:id, где :id соответствует id желаемого репозитория.

secret - параметр secret в настройках github, используется для проверки валидности источника запроса. Если не указан, проверка игнорируется. Необязательный параметр.

ontologies - ассоциативный массив конфигураций онтологий.

Ключи ontologies:

file - относительный путь к файлу онтологии, для которого будет сгенерирована документация. Обязательный параметр.

webname - имя папки, в которой будут находится файл онтологии и файл документации для нее. Онтология будет помещена в нее с исходным именем, документация - с аналогичным, но с расширением .html Например: для онтологии onto.owl, у которой задан параметр "webname": "test", будет создана директория test в папке directories.web и в нее помещены файлы онтологии и документации. Доступны извне они будут по адресу http://yourdomain.example/test/onto, при запросе на который сервер на основе заголовков запроса определит, отдавать документацию или же онтологию. Также документация и онтология будут доступны по прямым ссылкам (http://yourdomain.example/test/onto.owl, http://yourdomain.example/test/onto.html). Обязательный параметр.

template - относительный путь к файлу шаблона. Шаблон должен содержать конструкции, совместимые с шаблонизатором jinja2. Если не указан, будет использован стандартный шаблон. Необязательный параметр.

## Взаимодействие

При изменении конфигурационного файла, а так же запуске системы "с нуля", нужно запустить файл OwlPub.py Будет осуществлена проверка наличия всех указанных в конфигурационном файле репозиториев и автоматически клонированы недостающие, после чего для всех онтологий будет сгенерирована новая документация согласно их конфигурации.

Вебхук запускается автоматически со стартом системы с помощью uWSGI и прослушивает 2 адреса: адрес вида http://yourdomain.example/webhook (упрощенный для гитхаба, идентификация репозитория просиходит по параметру clone_url) и адрес вида http://yourdomain.example/webhook/:id (см. описание параметра webhook_id). В случае успешной проверки подлинности (см. параметр secret в настройках репозитория) будет осуществлена синхронизация с удаленным репозиторием и регенерация документации для всех онтологий, указанных в его конфигурации.